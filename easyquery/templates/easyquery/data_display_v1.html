{% extends "backendBasev1.html" %}

{% load static %}

{% comment %}
	This is the template for the coach who has successfully logged in.
{% endcomment%}


{%block navContent%}

			<a href="/" class="d-block p-3 link-dark text-decoration-none" title="Icon-only" style="position:absolute;left:-32px;top:-15px" data-bs-toggle="tooltip" data-bs-placement="right">
              <svg width="100" height="100" viewBox="0 0 350 245.07883791288577" class="css-1j8o68f">
				  <defs id="SvgjsDefs2498"></defs>
				  <g id="SvgjsG2499" featurekey="pxMwYC-0" transform="matrix(1.7033486853732833,0,0,1.7033486853732833,89.82190778119704,-9.680134789524573)" fill="#177b8f">
					  	<path xmlns="http://www.w3.org/2000/svg" d="M43.644,49.132c4.504,0,8.169-3.665,8.169-8.169s-3.665-8.169-8.169-8.169s-8.169,3.665-8.169,8.169  S39.139,49.132,43.644,49.132z M43.644,34.794c3.401,0,6.169,2.768,6.169,6.169s-2.768,6.169-6.169,6.169s-6.169-2.768-6.169-6.169  S40.242,34.794,43.644,34.794z M63.808,49.039c-1.31,0-2.375,1.065-2.375,2.375s1.065,2.375,2.375,2.375s2.375-1.065,2.375-2.375  S65.117,49.039,63.808,49.039z M62.433,62.039c-0.988,0-1.792,0.804-1.792,1.792s0.804,1.792,1.792,1.792  c0.988,0,1.792-0.804,1.792-1.792S63.42,62.039,62.433,62.039z M51.813,57.664c0,1.14-0.927,2.067-2.067,2.067  s-2.068-0.927-2.068-2.067s0.928-2.068,2.068-2.068S51.813,56.524,51.813,57.664z M19.975,30.727c1.813,0,3.288-1.475,3.288-3.288  s-1.475-3.288-3.288-3.288s-3.288,1.475-3.288,3.288S18.162,30.727,19.975,30.727z M19.975,26.151c0.71,0,1.288,0.578,1.288,1.288  c0,0.71-0.578,1.288-1.288,1.288s-1.288-0.578-1.288-1.288C18.688,26.729,19.265,26.151,19.975,26.151z M15.328,42.102  c0-1.057,0.86-1.917,1.917-1.917c1.057,0,1.917,0.86,1.917,1.917c0,1.057-0.86,1.917-1.917,1.917  C16.188,44.018,15.328,43.158,15.328,42.102z M26.412,56.596c0-1.838-1.496-3.333-3.333-3.333s-3.333,1.496-3.333,3.333  s1.495,3.333,3.333,3.333S26.412,58.434,26.412,56.596z M21.745,56.596c0-0.735,0.598-1.333,1.333-1.333  c0.735,0,1.333,0.598,1.333,1.333c0,0.735-0.598,1.333-1.333,1.333C22.343,57.929,21.745,57.331,21.745,56.596z M85.231,47.534  h1.452c1.104,0,2-0.896,2-2V35.352c0-1.104-0.896-2-2-2h-2.753c0.693-3.183,0.389-3.969,0.245-4.345l-0.053-0.136  c-0.867-2.254-3.507-9.112-8.435-14.212c-5.43-5.62-16.176-8.976-28.745-8.976c-9.917,0-19.1,2.186-24.565,5.847  C8.388,20.902,8.196,32.905,9.339,46.485c1.2,14.251,10.664,21.666,13.866,23.785v22.047c0,1.104,0.896,2,2,2h36.201  c1.088,0,1.976-0.869,2-1.957c0.065-2.99,0.223-6.606,0.37-7.41c0.333-1.294,1.4-2.001,1.981-2.452  c0.722-0.065,8.769-0.191,10.939-0.273c1.722-0.065,3.362-1.808,4.874-5.18c0.114-0.253,0.173-0.527,0.175-0.804l0.099-13.535  l3.861-0.313c1.5-0.097,4.297-1.045,5.272-3.979C91.3,57.446,91.463,56.956,85.231,47.534z M84.683,37.352v6.182l-7.593-0.016  c-0.299-0.301-0.907-1.15-0.907-3.076c0-1.99,0.623-2.815,0.884-3.075L84.683,37.352z M65.787,65.137  c0.276,0.924,0.452,2.159-0.274,2.789c-0.739,0.641-2.104,0.549-2.6,0.321c-1.073-0.493-7.358-6.619-8.917-7.171  c-2.474-0.876-5.423,0.692-6.519,1.364l-1.43-0.733c-0.258-1.545-0.478-3.385-0.747-6.038c3.7,0.068,16.894-7.296,17.965-7.691  c0.218,0.047,3.815,1.508,6.091,2.132C67.972,53.04,64.541,60.961,65.787,65.137z M60.829,82.127h-5.58  c0.052-0.134,0.086-0.275,0.077-0.419l-0.056-0.936h6.598C61.485,81.217,61.13,81.683,60.829,82.127z M54.831,82.877h5.531  c-0.179,0.317-0.471,1.139-0.508,1.355h-5.83L54.831,82.877z M52.983,85.98l0.594-0.997h6.175c-0.041,0.379-0.079,0.834-0.115,1.355  h-6.67L52.983,85.98z M52.935,87.088h6.656c-0.023,0.415-0.045,0.869-0.066,1.355h-6.649L52.935,87.088z M62.543,80.045  c-0.036-0.011-0.071-0.022-0.111-0.022h-7.208l-0.081-1.355h5.947c0.65,0.379,1.26,0.727,1.811,1.037  C62.781,79.813,62.662,79.927,62.543,80.045z M55.098,77.917l-0.081-1.355h2.596c0.759,0.477,1.5,0.931,2.209,1.355H55.098z   M54.972,75.813l-0.061-1.008c0.509,0.344,1.019,0.68,1.525,1.008H54.972z M52.82,73.343l0.491,8.178l-2.175,3.652  c-0.085,0.142-0.133,0.303-0.14,0.468l-0.204,4.676H48.62v-3.369c0-0.5-0.37-0.924-0.866-0.991l-3.349-0.453v-2.17l3.081,0.417  c0.289,0.039,0.575-0.049,0.792-0.238c0.217-0.19,0.342-0.464,0.342-0.753v-3.737c0-0.5-0.37-0.924-0.866-0.991l-3.349-0.453v-2.005  l3.081,0.417c0.289,0.04,0.575-0.048,0.792-0.238c0.217-0.19,0.342-0.464,0.342-0.753v-3.737c0-0.5-0.37-0.924-0.866-0.991  l-3.349-0.454V67.85l2.422,0.328C48.365,69.896,50.513,71.672,52.82,73.343z M40.209,90.317v-0.77c0-0.5-0.37-0.924-0.866-0.991  l-3.349-0.454v-1.718l3.08,0.417c0.289,0.037,0.575-0.048,0.792-0.238c0.217-0.19,0.342-0.464,0.342-0.753v-4.188  c0-0.5-0.37-0.924-0.866-0.991l-3.349-0.454v-1.718l3.08,0.417c0.289,0.041,0.575-0.048,0.792-0.238  c0.217-0.19,0.342-0.464,0.342-0.753v-4.023c0-0.5-0.37-0.924-0.866-0.991l-3.349-0.453v-1.718l3.08,0.417  c0.289,0.039,0.575-0.049,0.792-0.238c0.217-0.19,0.342-0.464,0.342-0.753v-3.987c0-0.5-0.37-0.924-0.866-0.991l-3.349-0.454v-1.718  l3.08,0.417c0.289,0.038,0.575-0.048,0.792-0.238c0.217-0.19,0.342-0.464,0.342-0.753v-1.137c0.666,0.413,6.411,3.194,6.411,3.194  v1.673l-3.081-0.417c-0.286-0.037-0.575,0.048-0.792,0.238s-0.342,0.464-0.342,0.753v3.987c0,0.5,0.37,0.924,0.866,0.991  l3.349,0.454v1.718l-3.081-0.417c-0.286-0.037-0.575,0.048-0.792,0.238s-0.342,0.464-0.342,0.753v4.023  c0,0.5,0.37,0.924,0.866,0.991l3.349,0.453v1.718l-3.081-0.417c-0.286-0.041-0.575,0.048-0.792,0.238  c-0.217,0.19-0.342,0.464-0.342,0.753v4.189c0,0.5,0.37,0.924,0.866,0.991l3.349,0.453v1.718l-3.081-0.417  c-0.286-0.038-0.575,0.049-0.792,0.238c-0.217,0.19-0.342,0.464-0.342,0.753v0.203H40.209z M29.879,61.608l0.311,1.309h-1.298  C29.175,62.454,29.502,62.014,29.879,61.608z M30.416,71.338h-3.211v-1.355h3.592L30.416,71.338z M29.12,77.917h-1.915v-1.355h2.142  L29.12,77.917z M28.995,78.667l-0.142,0.852c-0.026,0.156-0.015,0.315,0.033,0.465l0.012,0.038h-1.692v-1.355H28.995z   M29.133,80.772l0.427,1.355h-2.355v-1.355H29.133z M29.472,75.813h-2.267v-1.62h2.538L29.472,75.813z M27.205,84.983h3.021  l0.117,1.355h-3.138V84.983z M27.205,84.233v-1.355h2.591l0.342,1.086l0.023,0.27H27.205z M29.949,72.998  c-0.01,0.035-0.018,0.07-0.023,0.105l-0.057,0.34h-2.663v-1.355h3L29.949,72.998z M31.379,67.914l-0.371,1.319h-3.803v-0.077  c0-0.204-0.051-1.008-0.01-1.278h4.175L31.379,67.914z M27.328,67.127c0.083-0.418,0.188-0.874,0.328-1.355h3.214l0.322,1.355  H27.328z M28.476,63.667h1.893l0.322,1.355h-2.794C28.056,64.573,28.252,64.117,28.476,63.667z M27.205,87.088h3.203l0.117,1.355  h-3.32V87.088z M32.121,83.682c-0.006-0.073-0.021-0.145-0.042-0.214l-1.214-3.855l2.51-11.408c0.046-0.164,0.049-0.336,0.01-0.502  l-1.768-7.431c1.404-1.022,4.779-0.793,6.593-0.036v1.02l-3.08-0.417c-0.287-0.038-0.575,0.049-0.792,0.238  c-0.217,0.19-0.342,0.464-0.342,0.753v3.737c0,0.5,0.37,0.924,0.866,0.991l3.349,0.454v1.969l-3.08-0.417  c-0.287-0.038-0.575,0.049-0.792,0.238c-0.217,0.19-0.342,0.464-0.342,0.753v3.736c0,0.5,0.37,0.924,0.866,0.991l3.349,0.454v2.005  l-3.08-0.417c-0.287-0.04-0.575,0.048-0.792,0.238c-0.217,0.19-0.342,0.464-0.342,0.753v3.737c0,0.5,0.37,0.924,0.866,0.991  l3.349,0.453v2.17l-3.08-0.417c-0.287-0.04-0.575,0.048-0.792,0.238c-0.217,0.19-0.342,0.464-0.342,0.753v3.737  c0,0.5,0.37,0.924,0.866,0.991l2.58,0.349h-4.747L32.121,83.682z M30.839,40.963c0-4.633,2.439-8.812,6.416-11.097  c1.009,1.445,2.681,2.395,4.573,2.395c2.392,0,4.43-1.516,5.221-3.636c5.492,1.514,9.4,6.567,9.4,12.338  c0,8.495-8.532,12.805-12.805,12.805C36.583,53.768,30.839,48.024,30.839,40.963z M31.254,11.836  c2.415-0.749,5.127-1.315,8.023-1.679c0.061,1.752,0.199,4.099,0.506,5.177c0.702,2.464,1.597,4.397,2.377,5.792  c-1.613-0.079-3.064,0.675-3.495,0.973C37.668,21.063,32.438,14.375,31.254,11.836z M47.403,26.654  c-0.009-1.709-0.791-3.238-2.013-4.255c-0.127-0.155-0.579-0.73-1.157-1.693c1.137,0.176,2.298,0.435,3.473,0.791  c6.275,1.9,8.353,6.57,8.725,7.542c-0.382,0.84-0.848,1.669-1.405,2.48C53.094,29.189,50.454,27.454,47.403,26.654z M38.252,26.685  c0-1.972,1.604-3.576,3.576-3.576s3.576,1.604,3.576,3.576s-1.604,3.576-3.576,3.576S38.252,28.656,38.252,26.685z M71.228,48.527  c-2.928-0.701-6.256-2.053-6.374-2.101c1.267-1.871,3.49-5.68,3.39-9.29c-0.143-5.198,2.135-6.846,2.777-7.207l9.326,0.66  c-0.094,0.869-0.466,2.628-0.906,4.231c-0.049,0.18-0.065,0.363-0.063,0.545h-2.633c-0.15,0-2.563,1.232-2.563,5.075  c0,3.717,1.873,4.839,2.086,4.955c0.146,0.079,0.31,0.121,0.477,0.121h2.384C77.905,46.717,74.723,49.367,71.228,48.527z   M79.683,28.538l-8.784-0.622c-0.147-0.009-4.858,1.839-4.653,9.275c0.1,3.643-2.815,7.833-3.606,8.901  c-0.928,0.346-3.541,1.569-6.687,3.083c1.574-2.352,2.496-5.176,2.496-8.212c0-2.822-0.818-5.49-2.23-7.77  c0.069-0.055,0.148-0.097,0.203-0.172c5.542-7.665,3.539-16.88-0.176-22.625c7.275,1.148,13.269,3.63,16.565,7.042  C76.273,21.023,78.509,25.718,79.683,28.538z M53.534,10.035c3.066,3.809,5.407,10.201,3.815,16.401  c-1.298-2.146-3.982-5.315-9.064-6.854c-1.762-0.534-3.503-0.875-5.187-1.032c-0.486-1.053-2.098-4.967-1.826-8.609  C43.11,9.774,51.413,9.807,53.534,10.035z M29.331,12.499c0.825,2.064,3.483,5.874,4.581,7.238c-3.607,1.335-5.891,3.446-7.041,4.77  l-5.014-7.603C22.698,16.205,27.53,13.178,29.331,12.499z M20.345,18.244l5.628,8.534c0.186,0.281,0.499,0.449,0.835,0.449  c0.004,0,0.009,0.001,0.014,0c0.976-0.133,3.183-4.155,8.466-5.854c0.852,0.975,1.578,1.743,1.962,2.14  c-1.53,2.253-0.932,4.094-0.822,4.529C29.208,32.458,28.5,39.375,29,43.03l-15.004,7.344C12.813,40.625,10.875,26.094,20.345,18.244  z M14.529,52.34l14.896-7.291c1.748,6.074,7.281,10.549,13.873,10.702c0.222,2.201,0.297,3.355,0.514,4.833  c0,0-8.656-6.083-14.966-1.252c-2.482,1.901-3.183,5.737-3.519,7.549C23.112,65.407,17.182,60.808,14.529,52.34z M27.205,89.193  h3.384l0.097,1.124h-3.481V89.193z M52.794,90.317l0.049-1.124h6.652c-0.013,0.361-0.026,0.73-0.038,1.124H52.794z M79.695,58.867  c-1.033,0.084-1.831,0.943-1.838,1.979l-0.108,14.929c-0.496,1.019-1.043,2.245-1.549,2.465c-1.853,0.807-10.273,0.484-10.991,0.593  c-3.756-2.071-12.45-7.255-16.588-11.658v-3.093c1.089-0.66,3.216-1.65,4.707-1.122c1.146,0.406,7.342,6.518,8.75,7.104  c2.047,0.852,3.918,0.091,4.746-0.628c0.845-0.734,1.684-2.174,0.88-4.871c-0.994-3.332,2.039-10.685,3.646-13.993  c3.949,0.636,7.301-1.86,8.88-3.333c2.785,4.173,6.849,8.494,6.65,10.451C86.8,58.477,79.695,58.867,79.695,58.867z"></path></g>
			  </svg>
				<span class="visually-hidden">easyQuery</span>
           </a>


	<ul class="nav nav-pills py-3 nav-flush flex-column mb-auto text-center" style="position:relative;top:59px;" >
              <li class="nav-item">
                 <a href="/" class="nav-link py-3 active border-bottom" id="home" aria-current="page" title="Demo" data-bs-toggle="tooltip" data-bs-placement="right">
                    <svg class="bi" width="24" height="24" role="img" aria-label="Home">
                       <use xlink:href="#home"/>
                    </svg>
                 </a>
              </li>
              <li>
                 <a href="/easyquery/v1/todolist/teams" id="teams" class="nav-link py-3 border-bottom" title="Team" data-bs-toggle="tooltip" data-bs-placement="right">
                    <svg class="bi" width="24" height="24" role="img" aria-label="Dashboard">
                       <use xlink:href="#speedometer2"/>
                    </svg>
                 </a>
              </li>
              <li>
                 <a href="/easyquery/v1/todolist/roadmap" id="roadmap" class="nav-link py-3 border-bottom" title="Roadmap" data-bs-toggle="tooltip" data-bs-placement="right">
                    <svg class="bi" width="24" height="24" role="img" aria-label="Orders">
                       <use xlink:href="#table"/>
                    </svg>
                 </a>
              </li>
              <li>
                 <a href="/easyquery/v1/todolist/questions" id="questions" class="nav-link py-3 border-bottom" title="Questions" data-bs-toggle="tooltip" data-bs-placement="right">
                    <svg class="bi" width="24" height="24" role="img" aria-label="Products">
                       <use xlink:href="#grid"/>
                    </svg>
                 </a>
              </li>
	</ul>
{% endblock%}

{%block mainContent%}
<style>
        .custom-table {
            border-collapse: collapse;
            width: 100%;
        }

        .custom-table th, .custom-table td {
            padding: 8px;
            border: 1px solid #ddd;
        }

        .custom-table th {
            background-color: #f2f2f2;
            color: #333;
            font-weight: bold;
						font-size:16px;
        }

        .custom-table tr:hover {
            background-color: #f5f5f5;
        }

				.custom-table .row_heading.level0{
					display: none;
				}

				.custom-table .blank.level0{
					display: none;
				}
				.custom-table td{
					max-height: 100px;
					max-width: 200px;
				 	overflow: hidden;
				 	text-overflow: ellipsis;
				 	white-space: nowrap;
				}
    </style>
<section class="py-5 text-center table-wrapper" style="margin:25px">
		<div style="margin:25px">
	  {% csrf_token %}
		<div class="row">
			<div class="col-lg-6 col-md-8 mx-auto">
				 <h2>Data Display: {{this_study_name}}</h2>
			</div>
            <div style="padding: 15px;">
            </div>
		</div>
		<div style="overflow-y:auto;" id="table-wrapper">
		     {{ df_html_str | safe }}
		</div>
		<div class="row align-items-md-stretch p-5 mb-4 bg-light rounded-3">
      <div class="col-md-6">
				<div class="h-100 p-5 bg-light border rounded-3">
					<h2>Talk to your Data:</h2>
					<div class="col-md-12">
						<form name="gen_AI_question_form" enctype="multipart/form-data" method="post" action="{% url 'easyquery:answer_user_question' %}" >
              <div class="form-group">
									<input type="hidden" name="this_study_name" id="this_study_name" value="{{this_study_name}}"/>
                  <textarea rows="10" class="form-control" id="textarea_gen_AI_question" name="textarea_gen_AI_question"></textarea>
              </div>
						</form>
          </div>
					<div class="row">
						<div class="col-4"></div>
						<div class="col-4">
			      	<a href="javascript:void(0)" name="button_gen_AI_question" id="button_gen_AI_question" class="btn btn-primary btn-lg px-4">Send</a>
			    	</div>
						<div class="col-4">
							<button class="btn btn-success" id="btn-success" type="button" disabled>
							  <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
							  <span class="visually-hidden">Loading...</span>
							</button>
						</div>
					</div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="h-100 p-5 bg-light border rounded-3">
					<h2>GPT Results:</h2>
					<div class="my-3 p-3 bg-body rounded shadow-sm">
				        <div class="d-flex text-muted pt-3" style="word-wrap: break-word;">
				            <p class="fs-5 col-md-12" id="p_output_str"></p>
				        </div>

				        <small class="d-block text-end mt-3">
				            <a href="javascript:void(0)" id="startHistory">History</a>
				        </small>
				    </div>
            
                    <br><br><br><br><br><br><br>
            
                   <div class="text-center mt-3" style="display: flex; justify-content: center; align-items:center;">
                       <button id="button_download_data" name="button_download_data" class="btn btn-primary">Download Data</button>
                   </div>
            
        </div>
      </div>
            
     
            
    </div>
</div>

<div class="modal right fade slide-panel" id="itemWindow" tabindex="-1" role="dialog" aria-labelledby="myModalLabel2">
	 <div class="modal-dialog" role="document">
			<div class="modal-content" style="width: 500px;">
				 <div class="modal-header">
						<h4 class="modal-title" id="myModalLabel">History
						</h4>
				 </div>
				 <div class="modal-body">
						<div class="container" id="event-list">
						</div>
				 </div>
			</div>
	 </div>
</div>
    
</section>


<script id="item-template" type="text/template">
	<div class="my-3 bg-body rounded">
		<div class="d-flex text-muted pt-3">
			<p class="pb-3 mb-0 border-bottom" style="text-align:left">
				<%=value%>
			</p>
		</div>
	</div>
    
</script>
<script type="text/javascript">
	$(document).ready(function () {
		$("#startHistory").click(function(event) {
			var mymodal = jQuery("#itemWindow");
			mymodal.off("hidden.bs.modal").on("hidden.bs.modal", function (e) {
				setTimeout(() =>
					jQuery(".modal-backdrop").css("z-index", 1050).addClass("modal-stack")
				);
				$("#event-list").html('');
			});
			mymodal.off("show.bs.modal").on("show.bs.modal", function () {
				$(this).find('#data_entry_form').trigger('reset');
				const zIndex = 1055 + 10 * jQuery(".modal:visible").length;
				jQuery(this).css("z-index", zIndex);
				jQuery(this).find(".modal-body").css({
					"max-height": "100%",
				});
				setTimeout(() =>
					jQuery(".modal-backdrop")
						.not(".modal-stack")
						.css("z-index", zIndex - 1)
						.addClass("modal-stack")
				);
			});

			mymodal.off("shown.bs.modal").on("shown.bs.modal", function () {
				const zIndex = 1055 + 10 * jQuery(".modal:visible").length;
				jQuery(this).css("z-index", zIndex);
				setTimeout(() =>
					jQuery(".modal-backdrop")
						.not(".modal-stack")
						.css("z-index", zIndex - 1)
						.addClass("modal-stack")
				);

				$.ajax({
						type: "GET",
						url: "/history",
						processData: false,
						contentType: false,
						cache: false,
						success: function(data) {
							 $.each( data , function( index, object ) {
									var profile_template = underscore.template(jQuery("#item-template").html(), {
										"value" : object["value"]
									});
								  $("#event-list").append(profile_template);
								});

						} //end success
					});
			});
			mymodal.modal("show");
		});

		$("#btn-success").hide();

		$(document).ajaxStart(function () {
			 $("#btn-success").show();
	 });

	 $(document).ajaxStop(function () {
			 $("#btn-success").hide();
	 });


		$("#button_gen_AI_question").click(function(event) {
            
            //url: "/easyquery/answer_user_question/v1",
            
			var user_question = $("#textarea_gen_AI_question").val();
			var study_name = $("#this_study_name").val();
			var formData = new FormData()
			formData.append("user_question", user_question);
			formData.append("this_study_name", study_name);
			console.log(formData);
			$.ajax({
					type: "POST",
					url: "/answer_user_question/v1",
					data: formData,
					processData: false,
					contentType: false,
					cache: false,
					success: function(data) {

				        //alert(JSON.stringify(data))
                        //return

						 result = JSON.parse(data)
						 var output_str = result[0]
						 var df_html_str = result[1]

						 //print output_str in p_output_str
						 $('#p_output_str').html(output_str);
                        
                        
                         $('#table-wrapper').fadeOut('fast', function() {
                            
                            // Change the HTML content
                            $(this).html(df_html_str);

                            // Fade in the new content
                            $(this).fadeIn('fast');
                         });

						 //add df_html_str representing new dataframe to
						 //$('#table-wrapper').html(df_html_str);

						 //alert(output_str)
						 //alert(df_html_str)


					} //end success

				});

		});
	});
    
    
    $("#button_download_data").click(function(event) {
        
        $.ajax({
            type: "POST",
            url: "/export_data/",
            xhrFields: {
                responseType: 'text' // This is important to handle binary data
            },
            success: function(data) {

                //alert("whatda?!")
                //return

                // Create a Blob object with the received data
                var blob = new Blob([data], { type: 'text/csv' });

                var link = document.createElement('a');
                link.href = window.URL.createObjectURL(blob);
                link.download = 'data.csv'; // Set the desired filename
                link.click();
                
                alert("download in progress")

            } //end success

        });

    
    });
    
</script>


{% endblock%}
